<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>列表</title>
</head>
<body>
    
    
    <div style="text-align:center;color:#969799;font-size:14px;font-family:PingFangSC-Regular;">
        <ul id="ul_list"></ul>
    </div>

    <div style="text-align:center;color:#969799;font-size:14px;font-family:PingFangSC-Regular;">
        <p id="p_error"></p>
    </div>

</body>
<script src="3rd/query/parse.js"></script>
<script>
    var dataURL = "https://raw.githubusercontent.com/MrDeveloperLiu/OTA/master/data/list.json"
    var datas = null
            
    document.addEventListener("readystatechange", function (e) {
        if (e.target.readyState === 'complete') {
            loadInfo()
        }
    })

    function loadInfo() {
        try {
            var xhttp = new XMLHttpRequest()
            xhttp.open("GET", dataURL, true)
            xhttp.onreadystatechange = function() {
              if (xhttp.readyState == 4){
                  console.log(xhttp.status + '|' + xhttp.responseText)
                  if (xhttp.status == 200){
                      loadAppInfo(xhttp.responseText)
                  }
              }
            };
            xhttp.send(null)
            
        }
        catch (e) {
        
            document.getElementById("p_error").innerText = e
        }
        
        var ul = document.getElementById('ul_list')
        ul.addEventListener("click", function (e) {
            
            var target = e.target;
            
            
            while (target && target.parentNode != ul) {
                target = target.parentNode;
            }
            
            if ("li" === target.class) {
                
                var item = datas[target.idx]
                var toURL = BDURLParser.buildURL("download.html", item);
                window.location.href = toURL
            }
        });
    }

    function loadAppInfo(resp) {
        try {
            datas = JSON.parse(resp)
            
            var fragment = document.createDocumentFragment()
            
            for (idx in datas) {
                var item = datas[idx];
                
                var li = document.createElement("li")
                li.innerText = item.name
                li.idx = idx
                li.class = "li"
                fragment.appendChild(li)
                
            }
            
            document.getElementById('ul_list').appendChild(fragment)

        }
        catch (e){
            console.log(e);
        }
    }



</script>
</html>
